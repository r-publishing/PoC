{"version":3,"sources":["views/LoginView.tsx"],"names":["publishSteps","selector","content","LoginView","connect","state","platform","getPlatform","isLoading","reducer","dispatch","init","a","type","payload","authorised","privateKey","publicKey","rchainToolkit","publicKeyFromPrivateKey","registryUri","user","store","props","useTour","setIsOpen","setCurrentStep","setSteps","currentStep","useState","isUser","setUser","slides","React","useRef","useEffect","current","lockSwipes","localStorage","getItem","setItem","toString","menuTourStep","parseInt","setTimeout","demo","Object","keys","length","handlePublisherLogin","masterRegistryUri","publisherPrivKey","handleAttestorLogin","removeItem","attestorPrivKey","handleStoreLoginAsAlice","alicePrivKey","handleStoreLoginAsBob","bobPrivKey","handleUserLoginAsAlice","handleUserLoginAsBob","ref","Fragment","className","disabled","onClick"],"mappings":"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","file":"static/js/7.aaa310d4.chunk.js","sourcesContent":["import { Dispatch } from 'redux';\r\nimport { connect } from 'react-redux';\r\nimport * as rchainToolkit from 'rchain-toolkit';\r\nimport React, { useEffect, useState /*,  Suspense, useEffect */ } from 'react';\r\n//import { useHistory } from 'react-router';\r\n//import { Link } from 'react-router-dom';\r\n//import Swal from 'sweetalert2';\r\n\r\nimport {\r\n  IonContent,\r\n  //IonItem,\r\n  //IonInput,\r\n  IonLabel,\r\n  IonButton,\r\n  IonSlides,\r\n  IonSlide,\r\n  IonSpinner,\r\n  //IonGrid,\r\n  //IonRow,\r\n  //IonCol,\r\n  //IonToggle,\r\n  //IonLoading,\r\n} from '@ionic/react';\r\nimport './LoginView.scoped.css';\r\nimport { HistoryState, getPlatform } from '../store';\r\n//import { Users } from '../users/users';\r\nimport { useTour } from '@reactour/tour';\r\n\r\n// configure the tour\r\nconst publishSteps = [\r\n  {\r\n    selector: '.attestation-step-start',\r\n    content: 'Login as Publisher to upload a photo.',\r\n  },\r\n  {\r\n    selector: '.attestation-step-attest',\r\n    content: 'Login as Attestor and attest the photo.',\r\n  },\r\n  {\r\n    selector: '.attestation-step-start',\r\n    content: 'Log back in as Publisher and push the NFT to marketplace.',\r\n  },\r\n  {\r\n    selector: '.attestation-step-alice-marketplace',\r\n    content: 'Browse the public marketplace as Alice and purchase something.',\r\n  },\r\n  {\r\n    selector: '.attestation-step-alice-inventory',\r\n    content: 'Alice can always find her purchased items in her personal inventory.',\r\n  },\r\n  {\r\n    selector: '.attestation-step-bob-marketplace',\r\n    content: \"Alice has put her NFT for sale. Go back to marketplace and find the NFT there once again.\",\r\n  },\r\n  {\r\n    selector: '.attestation-step-bob-inventory',\r\n    content: \"The NFT has now traded hands from Alice to Bob and should be available in Bob's personal inventory.\",\r\n  },\r\n  // ...\r\n]\r\n\r\ninterface Demo {\r\n  id: string;\r\n  masterRegistryUri: string;\r\n  publisherPrivKey: string;\r\n  attestorPrivKey: string;\r\n  alicePrivKey: string;\r\n  bobPrivKey: string;\r\n}\r\n\r\n\r\ninterface LoginViewProps {\r\n  platform: string;\r\n  isLoading: boolean;\r\n  action: string;\r\n  init: (a: {\r\n    registryUri: string;\r\n    privateKey: string;\r\n    platform: string;\r\n    user: string;\r\n    store: string;\r\n  }) => void;\r\n  demo: Demo | undefined;\r\n}\r\n\r\nconst LoginViewComponent: React.FC<LoginViewProps> = props => {\r\n  const { setIsOpen, setCurrentStep, setSteps, currentStep } = useTour();\r\n\r\n  const [isUser, setUser] = useState<boolean>(false);\r\n\r\n  const slides = React.useRef<HTMLIonSlidesElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    slides.current?.lockSwipes(true);\r\n\r\n    if (!localStorage.getItem('tour')) {\r\n      localStorage.setItem('tour', currentStep.toString());\r\n    }\r\n    const menuTourStep = parseInt(localStorage.getItem('tour') || '0');\r\n    setSteps(publishSteps);\r\n    setTimeout(() => {\r\n      if (props.demo && Object.keys(props.demo || {}).length > 0) {\r\n        setCurrentStep(menuTourStep);\r\n        //setCurrentStep(0);\r\n        setIsOpen(true);\r\n      }\r\n    }, 100);\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const handlePublisherLogin = () => {\r\n    //localStorage.removeItem('user');\r\n    \r\n    localStorage.setItem('user', 'publisher');\r\n    localStorage.setItem('publisher', 'true');\r\n    \r\n    props.init({\r\n      registryUri: props.demo?.masterRegistryUri || '',\r\n      privateKey:\r\n        props.demo?.publisherPrivKey || '',\r\n      platform: props.platform,\r\n      user: 'publisher',\r\n      store: \"store\"\r\n    });\r\n  }\r\n\r\n  const handleAttestorLogin = async () => {\r\n    //localStorage.removeItem('user');\r\n    \r\n    localStorage.removeItem('publisher');\r\n    localStorage.setItem('user', 'attestor');\r\n\r\n    props.init({\r\n      registryUri: props.demo?.masterRegistryUri || '',\r\n      privateKey: props.demo?.attestorPrivKey || '',\r\n      platform: props.platform,\r\n      user: 'attestor',\r\n      store: \"store\"\r\n    });\r\n  };\r\n\r\n  const handleStoreLoginAsAlice = async () => {\r\n    \r\n    localStorage.setItem('user', 'buyer');\r\n    localStorage.removeItem('wallet');\r\n\r\n    props.init({\r\n      registryUri: props.demo?.masterRegistryUri || '',\r\n      privateKey: props.demo?.alicePrivKey || '',\r\n      platform: props.platform,\r\n      user: 'publisher',\r\n      store: \"public_store\"\r\n    });\r\n  }\r\n\r\n   const handleStoreLoginAsBob = async () => {\r\n    \r\n     localStorage.setItem('user', 'buyer2');\r\n     //localStorage.setItem('wallet', 'true');\r\n     localStorage.removeItem('wallet');\r\n\r\n     props.init({\r\n       registryUri: props.demo?.masterRegistryUri || '',\r\n       privateKey: props.demo?.bobPrivKey || '',\r\n       platform: props.platform,\r\n       user: 'buyer', //TODO: see all\r\n       store: \"public_store\"\r\n     });\r\n   };\r\n\r\n   const handleUserLoginAsAlice = async () => {\r\n    \r\n    localStorage.setItem('user', 'buyer');\r\n    localStorage.setItem('wallet', 'true');\r\n\r\n    props.init({\r\n      registryUri: props.demo?.masterRegistryUri || '',\r\n      privateKey: props.demo?.alicePrivKey || '',\r\n      platform: props.platform,\r\n      user: 'buyer',\r\n      store: \"public_store\"\r\n    });\r\n  };\r\n\r\n  const handleUserLoginAsBob = async () => {\r\n    \r\n    localStorage.setItem('user', 'buyer2');\r\n    localStorage.setItem('wallet', 'true');\r\n\r\n    props.init({\r\n      registryUri: props.demo?.masterRegistryUri || '',\r\n      privateKey: props.demo?.bobPrivKey || '',\r\n      platform: props.platform,\r\n      user: 'buyer2',\r\n      store: \"public_store\"\r\n    });\r\n  };\r\n\r\n  return (\r\n    <IonContent>\r\n      <IonSlides ref={slides}>\r\n        <IonSlide>\r\n          <React.Fragment>\r\n            <div className=\"login\">\r\n              <h2>What would you like to do?</h2>\r\n\r\n              <div className=\"container\">\r\n                {/* Publisher */}\r\n                <div className=\"LoadButtonDiv\">\r\n                  <IonButton\r\n                    disabled={isUser || Object.keys(props.demo || {}).length === 0}\r\n                    onClick={async () => {\r\n                      setUser(true);\r\n                      handlePublisherLogin();\r\n                    }}\r\n                    className=\"btn attestation-step-start\"\r\n                  >\r\n                    Publish\r\n                  </IonButton>\r\n                </div>\r\n                {/* Attestor */}\r\n                <div className=\"LoadButtonDiv\">\r\n                  <IonButton\r\n                    disabled={isUser || Object.keys(props.demo || {}).length === 0}\r\n                    onClick={async () => {\r\n                      setUser(true);\r\n                      handleAttestorLogin();\r\n                    }}\r\n                    className=\"btn attestation-step-attest\"\r\n                  >\r\n                    Attest\r\n                  </IonButton>\r\n                </div>\r\n                {/* Reseller */}\r\n                <div className=\"LoadButtonDiv\">\r\n                  <IonButton\r\n                    disabled={isUser || Object.keys(props.demo || {}).length === 0}\r\n                    onClick={async () => {\r\n                      setUser(true);\r\n                      handleStoreLoginAsAlice();\r\n                    }}\r\n                    className=\"attestation-step-alice-marketplace\"\r\n                  >\r\n                    Marketplace (as Alice)\r\n                  </IonButton>\r\n                </div>\r\n                {/* Reseller */}\r\n                <div className=\"LoadButtonDiv\">\r\n                  <IonButton\r\n                    disabled={isUser || Object.keys(props.demo || {}).length === 0}\r\n                    onClick={async () => {\r\n                      setUser(true);\r\n                      handleStoreLoginAsBob();\r\n                    }}\r\n                    className=\"attestation-step-bob-marketplace\"\r\n                  >\r\n                    Marketplace (as Bob)\r\n                  </IonButton>\r\n                </div>\r\n                {/* wallet*/}\r\n                <div className=\"LoadButtonDiv\">\r\n                  <IonButton\r\n                    disabled={isUser || Object.keys(props.demo || {}).length === 0}\r\n                    onClick={async () => {\r\n                      setUser(true);\r\n                      handleUserLoginAsAlice();\r\n                    }}\r\n                    className=\"btn attestation-step-alice-inventory\"\r\n                  >\r\n                    Alice's NFTs\r\n                  </IonButton>\r\n                </div>\r\n                {/* wallet*/}\r\n                <div className=\"LoadButtonDiv\">\r\n                  <IonButton\r\n                    disabled={isUser || Object.keys(props.demo || {}).length === 0}\r\n                    onClick={async () => {\r\n                      setUser(true);\r\n                      handleUserLoginAsBob();\r\n                    }}\r\n                    className=\"btn attestation-step-bob-inventory\"\r\n                  >\r\n                    Bob's NFTs\r\n                  </IonButton>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </React.Fragment>\r\n        </IonSlide>\r\n      </IonSlides>\r\n      { (!props.demo || Object.keys(props.demo || {}).length === 0) && \r\n        <div className=\"DebugInfo\">\r\n        <IonLabel>[!!] Failed to fetch a fresh set of demo credentials from our API :(</IonLabel>\r\n        <IonLabel>NOTE: Please reload the page and try again, or contact us at info@r-publishing.com for assistance.</IonLabel>\r\n        </div>\r\n      }\r\n    </IonContent>\r\n  );\r\n};\r\nexport const LoginView = connect(\r\n  (state: HistoryState) => {\r\n    return {\r\n      platform: getPlatform(state),\r\n      isLoading: state.reducer.isLoading\r\n    };\r\n  },\r\n  (dispatch: Dispatch) => {\r\n    return {\r\n      init: (a: {\r\n        registryUri: string;\r\n        privateKey: string;\r\n        platform: string;\r\n        user: string;\r\n        store: string;\r\n      }) => {\r\n        dispatch({\r\n          type: 'INIT',\r\n          payload: {\r\n            platform: a.platform,\r\n            authorised: true,\r\n            privateKey: a.privateKey,\r\n            publicKey: rchainToolkit.utils.publicKeyFromPrivateKey(\r\n              a.privateKey as string\r\n            ),\r\n            registryUri: a.registryUri,\r\n            user: a.user,\r\n            store: a.store\r\n          },\r\n        });\r\n      },\r\n    };\r\n  },\r\n  \r\n)(LoginViewComponent);\r\n\r\nexport default LoginView;\r\n"],"sourceRoot":""}